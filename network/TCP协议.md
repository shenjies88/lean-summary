## 服务

以下列方式提供可靠性

- 数据会分割成TCP认为合适的数据块
- 确认重发定时器
- 数据和头部校验和
- 对失序数据排序
- 流量控制缓冲区

## 头部

通常情况下20字节，最多可扩展到60字节

- 16位源端口号+16位目的端口号
- 32位序列号
- 32位确认号
- 4位选项长度，6位保留，6位选项+16位窗口大小
  - URG紧急指针
  - ACK确认序号
  - PSH接收方尽快提交给应用层
  - RST重新连接
  - SYN同步序号，用来发起连接
  - FIN发送端完成发送任务
- 16位校验和+16位紧急指针
- 选项（最多40字节）

## 连接

三次握手

- SYN表示同步
- C表示客户端
- S表示i 服务端
- 
- C发送SYN序号请求
- S发送SYN序号并发送序号+1的确认号
- C发送S序号+1的确认号

## 终止

四次挥手

- FIN表示TCP链接关闭
- 主动终止方I
- 被动终止方P
- 
- I发送FIN标志进行终止
- P对I的报文进行确认
- P发送FIN标志进行终止
- I对P的报文进行确认

## 同时打开和同时关闭

打开

- 双方即是客户端，又是服务端
- 多发送一个TCP报文
- 同时发送SYN
- 同时确认SYN

关闭

- 发送的报文数同正常关闭相同

## TCP并发

- 服务器端有一个固定长度的，已经接受TCP连接的队列（已经完成三次握手），但还未被应用层接受，应用层接受会将其移出队列
- 该队列满时不会响应SYN请求
- 该队列不是服务器并发的因素，只是TCP的并发因素
- 在TCP阶段并不告知应用层源目的IP地址和目的端口号，目的是为了使错误的客户端请求无效

## 交互式数据流

交互工作

- 客户端每次键入数据都会发送TCP
- 客户端键入数据
- 服务端确认数据并发送回显
- 客户端确认回显

经受时延的确认

- 发送ACK时，有200毫秒的定时器时延，用于等待是否有数据要一起发送

TCP客户端的窗口总是小于标准值

- TCP发送数据时，应用层应用不能读取接受缓冲区的数据

## TCP成块数据流

窗口滑动

- 左沿右移是随着接收方的确认而移动
- 右沿右移是随着接收方确认并把数据从TCP缓冲区读取而移动

慢启动

- 发送方控制传输速率的标准
- 根据接收方的应答情况改变自己的发送速率

紧急模式

- 发送端发送一个字节的紧急数据
- 具体由接受端决定如何处理紧急数据

## TCP超时重传

重传的时间间隔测量

- 平滑公示

重传操作

- 收到三个同样的ack进行重传
- 会把需要重传期间收到的数据缓存并一起确认

重传策略

- 慢启动
- 拥塞避免
- 快速重传
- 快速恢复

## TCP的坚持定时器

坚持定时器

- 当发送方收到窗口为0的回应时，就启动坚持定时器
- 在定时器超时时还未收到窗口回应，就会发送窗口探测报文

糊涂窗口综合症

- 发送方避免发送小的报文段
- 接收方避免通告小窗口